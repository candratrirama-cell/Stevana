<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flydrama - Netflix Experience</title>
    <style>
        :root { --red: #E50914; --black: #000; --gray: #141414; }
        body { background: var(--black); color: #fff; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; margin: 0; }
        
        /* Navbar */
        header { 
            padding: 20px 5%; position: fixed; top: 0; width: 100%; z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
            display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
        }
        header h1 { color: var(--red); margin: 0; font-size: 1.8rem; letter-spacing: -1px; }

        /* Grid Netflix */
        .container { padding: 80px 5% 20px; }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); 
            gap: 10px; 
        }
        @media(min-width: 768px) { .grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); } }

        .card { 
            position: relative; transition: 0.3s; cursor: pointer; border-radius: 4px; overflow: hidden;
            background: var(--gray); aspect-ratio: 2/3;
        }
        .card:hover { transform: scale(1.05); z-index: 10; }
        .card img { width: 100%; height: 100%; object-fit: cover; }
        .card-title { 
            position: absolute; bottom: 0; padding: 10px; width: 100%;
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            font-size: 0.8rem; font-weight: bold; box-sizing: border-box;
        }

        /* Player Overlay */
        #player { 
            position: fixed; inset: 0; background: #000; z-index: 999; 
            display: none; flex-direction: column; 
        }
        .video-box { flex: 1; display: flex; align-items: center; justify-content: center; background: #000; }
        video { width: 100%; max-height: 80vh; }
        .ep-list { 
            height: 30%; background: #111; padding: 20px; overflow-y: auto; 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 10px;
        }
        .ep-item { 
            background: #333; padding: 10px; text-align: center; border-radius: 4px; 
            cursor: pointer; font-weight: bold; 
        }
        .ep-item.active { background: var(--red); }
        .close-btn { 
            position: absolute; top: 20px; left: 20px; z-index: 1001;
            background: rgba(255,255,255,0.2); border: none; color: #fff;
            width: 40px; height: 40px; border-radius: 50%; font-size: 1.5rem; cursor: pointer;
        }
    </style>
</head>
<body>

<header>
    <h1>FLY<span>DRAMA</span></h1>
</header>

<div class="container">
    <h2 id="status">Memuat Drama Populer...</h2>
    <div id="drama-grid" class="grid"></div>
</div>

<div id="player">
    <button class="close-btn" onclick="closePlayer()">âœ•</button>
    <div class="video-box">
        <video id="vid" controls autoplay playsinline></video>
    </div>
    <div id="episodes" class="ep-list"></div>
</div>

<script>
    const API = '/api/index';

    async function loadHome() {
        const res = await fetch(`${API}?type=home`);
        const data = await res.json();
        const grid = document.getElementById('drama-grid');
        grid.innerHTML = '';
        document.getElementById('status').innerText = 'Trending Sekarang';
        
        data.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${item.image}" onerror="this.src='https://via.placeholder.com/200x300?text=No+Poster'">
                <div class="card-title">${item.title}</div>
            `;
            card.onclick = () => openDrama(item.url);
            grid.appendChild(card);
        });
    }

    async function openDrama(url) {
        document.getElementById('player').style.display = 'flex';
        const epDiv = document.getElementById('episodes');
        epDiv.innerHTML = 'Memuat Episode...';
        
        const res = await fetch(`${API}?type=detail&url=${encodeURIComponent(url)}`);
        const data = await res.json();
        
        epDiv.innerHTML = '';
        data.episodes.forEach((ep, i) => {
            const div = document.createElement('div');
            div.className = 'ep-item';
            div.innerText = ep.episode_id;
            div.onclick = () => playEp(ep.url, div);
            epDiv.appendChild(div);
            if(i === 0) playEp(ep.url, div); // Putar ep 1 otomatis
        });
    }

    function playEp(url, el) {
        const v = document.getElementById('vid');
        v.src = `${API}?type=stream&url=${encodeURIComponent(url)}`;
        document.querySelectorAll('.ep-item').forEach(x => x.classList.remove('active'));
        el.classList.add('active');
        v.play();
    }

    function closePlayer() {
        document.getElementById('player').style.display = 'none';
        document.getElementById('vid').pause();
    }

    loadHome();
</script>
</body>
</html>
